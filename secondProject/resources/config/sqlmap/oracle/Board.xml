<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace = "kr.co.tripadvisor.client.mapper.BoardMapper">
	<resultMap id="boardMap" type="board">
		<result column="board_type" property="boardType" />
		<result column="board_no" property="boardNo" />
		<result column="title" property="title" />
		<result column="id" property="id" />
		<result column="content" property="content" />
		<result column="area" property="area" />
		<result column="attract" property="attract" />
		<result column="reg_date" property="regDate" />
		<result column="mod_date" property="modDate" />
		<result column="view_cnt" property="viewCnt" />
	</resultMap>
	
	<!-- 리스트 -->
	<select id="selectBoard" parameterType="boardSearch" resultMap="boardMap"> 
		select a.*
		  from board a
		 where board_type = #{boardType}
		   and attract in ()	
		   and area in ()
			<where>
				<!-- 다중조건 choose 단일 조건은 if. when test="" 조건 -->
				<choose>
					<when test="searchType == 'email' ">
						 email like '%' || #{searchWord} || '%'
					</when>
					<when test="searchType == 'addr' ">
						 addr like '%' || #{searchWord} || '%'
					</when>
					<otherwise>
						 name like '%' || #{searchWord} || '%'
					</otherwise>
				</choose>
			</where>
	  order by board_no desc
	</select>

	<!-- 게시물 쓰기 -->
	<insert id="insertBoard" parameterType="board">
		insert into board(
		board_type,
		board_no,
		title,
		id,
		content,
		area,
		attract 
		) values (
		#{board_type},
		#{board_no},
		#{title},
		#{id},
		#{content},
		#{area},
		#{attract}
		)
	</insert>
	
	<!-- 자유게시판 수정-->
	<update id="updateBoard" parameterType="board">
		update board
		   set title = #{title}
		   	   content = #{content}
		   	   area = #{area}
		   	   attract = #{attract}
		 where board_no = #{board_no}
	</update>
	
	<delete id="deleteBoard" parameterType="int">
		delete
		  from board
		 where board_no = #{board_no}
	</delete>
	
	<update id="uddateBoardViewCnt" parameterType="int">
		update board
		   set view_cnt = view_cnt + 1
		 where board_no = #{board_no}
	</update>
	
	<!-- comment -->
	
	<resultMap type="commentMap" id="comment">
		<result column="board_type" property="boardType" />
		<result column="comment_no" property="commentNo" />
		<result column="board_no" property="boardNo" />
		<result column="id" property="id" />
		<result column="content" property="content" />
		<result column="reg_date" property="regDate" />
	</resultMap>
	
	<select id="selectCommentByNo" parameterType="int" resultMap="commentMap">
		select *
		  from comment
		 where board_no = #{board_no}
	</select>
</mapper>